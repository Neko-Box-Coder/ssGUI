<!DOCTYPE html>

<html class="NDPage NDContentPage"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>DynamicImageAtlas</title><link rel="stylesheet" type="text/css" href="../../../../styles/main.css" /><script type="text/javascript" src="../../../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.3 (Development Release 1) -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');">

<script type="text/javascript">var q = window.location.search;if (q.indexOf("?Theme=") == 0){var t = q.slice(7);var e = t.indexOf(";");if (e != -1){  t = t.slice(0, e);  }if (document.documentElement.className == undefined){ document.documentElement.className = t + "Theme"; }else{ document.documentElement.className += " " + t + "Theme"; }}</script>

<a name="Topic54"></a><div class="CTopic TClass LC first">
 <div class="CTitle"><span class="Qualifier">ssGUI::&#8203;Backend::</span>&#8203;DynamicImageAtlas</div>
 <div class="NDClassPrototype" id="NDClassPrototype54"><div class="CPEntry TClass Current"><div class="CPName"><span class="Qualifier">ssGUI::&#8203;Backend::</span>&#8203;DynamicImageAtlas</div></div></div>
 <div class="CBody"><p>This is an internal data structure for managing image atlas for OpenGL backends.&nbsp; By default there's only 1 layer of image atlas, each layer has many cells for storing the textures.</p><p>You normally don't have to deal with this class.</p><div class="CHeading">Variables &amp; Constructor</div><pre class="CCode"><span class="SHKeyword">public</span>:<br />    <span class="SHKeyword">struct</span> ImageAtlasImageInfo<br />    {<br />        glm::ivec3 LocationInPixel;<br />        glm::ivec2 ImageSizeInPixel;<br />        <span class="SHKeyword">bool</span> HasMipmap;<br /><br />        <span class="SHKeyword">inline friend</span> std::ostream&amp; <span class="SHKeyword">operator</span>&lt;&lt; (std::ostream&amp; stream, <span class="SHKeyword">const</span> ImageAtlasImageInfo&amp; other)<br />        {<br />            stream  &lt;&lt; SSGUI_OUTPUT_CLASS_NAME(ImageAtlasImageInfo)<br />                    &lt;&lt; SSGUI_OUTPUT_VAR(LocationInPixel)<br />                    &lt;&lt; SSGUI_OUTPUT_VAR(ImageSizeInPixel)<br />                    &lt;&lt; SSGUI_OUTPUT_LAST_VAR(HasMipmap);<br /><br />            <span class="SHKeyword">return</span> stream;<br />        }<br />    };<br /><br /><span class="SHKeyword">private</span>:<br />    <span class="SHKeyword">typedef int</span> ImageId;<br />    <span class="SHKeyword">typedef int</span> CellsCount;<br /><br />    <span class="SHKeyword">struct</span> FreeCellsInfo<br />    {<br />        glm::ivec3 CellsPositionIndex;<br />        glm::ivec2 CellsCountIn2D;<br />    };<br /><br />    <span class="SHKeyword">const</span> glm::ivec2 CellSizeInPixel;                                   <span class="SHComment">//(Internal variable) The size in pixels of each cell in the image atlas</span><br />    <span class="SHKeyword">const</span> glm::ivec2 AtlasSizeInPixel;                                  <span class="SHComment">//See &lt;GetAtlasSize&gt;</span><br /><br />    glm::ivec2 UsableSizeInPixel;                                       <span class="SHComment">//(Internal variable) If the image atlas is created with size not in the multiples of cell size,</span><br />                                                                        <span class="SHComment">//                          there will be space not used.</span><br />                                                                        <span class="SHComment">//                          This variable denotes the total space subtracts the space that is not used.</span><br />    glm::ivec2 CellsCountInGrid;                                        <span class="SHComment">//(Internal variable) Number of cells in each layer. Same as UsableSizeInPixel / CellSizeInPixel.</span><br /><br />    ImageId NextImageId;                                                <span class="SHComment">//(Internal variable) Used to generate unique image Ids</span><br />    std::unordered_map&lt;ImageId, ImageAtlasImageInfo&gt; ImageInfos;        <span class="SHComment">//See &lt;GetImageInfo&gt;</span><br />    std::multimap&lt;CellsCount, FreeCellsInfo&gt; FreeCells;                 <span class="SHComment">//(Internal variable) Keeps track of all the free cells</span><br /><br />    std::<span class="SHKeyword">function</span>&lt;<span class="SHKeyword">bool</span>(<span class="SHKeyword">void</span>)&gt; OnRequestNewAtlasCallback;                <span class="SHComment">//See &lt;AddOnRequestNewAtlasCallback&gt;</span><br />    <span class="SHKeyword">int</span> MaxAtlasIndex;                                                  <span class="SHComment">//(Internal variable) Keeps track of how many layers of image atlas</span></pre><pre class="CCode">DynamicImageAtlas::DynamicImageAtlas(   glm::ivec2 atlasSize,<br />                                        glm::ivec2 cellSize,<br />                                        std::<span class="SHKeyword">function</span>&lt;<span class="SHKeyword">bool</span>(<span class="SHKeyword">void</span>)&gt; newAtlasRequestCallback) :    CellSizeInPixel(cellSize),<br />                                                                                                AtlasSizeInPixel(atlasSize),<br />                                                                                                UsableSizeInPixel(),<br />                                                                                                CellsCountInGrid(),<br />                                                                                                NextImageId(<span class="SHNumber">1</span>),<br />                                                                                                ImageInfos(),<br />                                                                                                FreeCells(),<br />                                                                                                OnRequestNewAtlasCallback(newAtlasRequestCallback),<br />                                                                                                MaxAtlasIndex(<span class="SHNumber">0</span>)<br />{<br />    <span class="SHComment">//First we calculate the actual atlas texture size we can use</span><br />    CellsCountInGrid = AtlasSizeInPixel / CellSizeInPixel;<br />    UsableSizeInPixel = CellsCountInGrid * CellSizeInPixel;<br /><br />    FreeCellsInfo cellsInfo;<br />    cellsInfo.CellsPositionIndex = glm::ivec3(<span class="SHNumber">0</span>, <span class="SHNumber">0</span>, <span class="SHNumber">0</span>);<br />    cellsInfo.CellsCountIn2D = CellsCountInGrid;<br />    FreeCells.insert(std::make_pair(CellsCountInGrid.x * CellsCountInGrid.y, cellsInfo));<br />}<br /><br /><span class="SHKeyword">bool</span> DynamicImageAtlas::RequestImage(ImageAtlasImageInfo imgInfo, <span class="SHKeyword">int</span>&amp; returnId)<br />{<br />    glm::ivec2 sizeNeeded = GetAllocatedImageSize(imgInfo);<br /><br />    <span class="SHComment">//Check if size needed exceeds atlas total size</span><br />    <span class="SHKeyword">if</span>(sizeNeeded.x &gt; UsableSizeInPixel.x || sizeNeeded.y &gt; UsableSizeInPixel.y)<br />        <span class="SHKeyword">return false</span>;<br /><br />    glm::ivec2 cellsNeeded = glm::ivec2( glm::vec2(sizeNeeded) / glm::vec2(CellSizeInPixel) + <span class="SHNumber">0.99f</span> );<br /><br />    <span class="SHComment">//Check if theres any free cells left</span><br />    <span class="SHKeyword">if</span>(FreeCells.empty())<br />    {<br />        <span class="SHComment">//Try to create another atlas</span><br />        <span class="SHKeyword">if</span>(!RequestNewAtlas())<br />            <span class="SHComment">//If unable, return false</span><br />            <span class="SHKeyword">return false</span>;<br />    }<br /><br />    auto foundIt = FindCells(cellsNeeded);<br /><br />    <span class="SHKeyword">if</span>(foundIt == FreeCells.end())<br />        <span class="SHKeyword">return false</span>;<br /><br />    FreeCellsInfo occupyCellsInfo = foundIt-&gt;second;<br /><br />    <span class="SHComment">//After this point, foundIt is no longer valid</span><br />    OccupyCells(foundIt, cellsNeeded);<br /><br />    imgInfo.LocationInPixel = occupyCellsInfo.CellsPositionIndex * glm::ivec3(CellSizeInPixel, <span class="SHNumber">1</span>);<br />    ImageInfos[NextImageId] = imgInfo;<br /><br />    returnId = NextImageId++;<br />    <span class="SHKeyword">return true</span>;<br />}</pre></div>
</div>

<a name="Functions"></a><a name="Topic619"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Functions</div>
</div>

<a name="RequestImage"></a><a name="Topic624"></a><div class="CTopic TFunction LC">
 <div class="CTitle">RequestImage</div>
 <div id="NDPrototype624" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">bool</span> RequestImage(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">ImageAtlasImageInfo&nbsp;</td><td class="PName last">imgInfo,</td></tr><tr><td class="PType first"><span class="SHKeyword">int</span>&amp;&nbsp;</td><td class="PName last">returnId</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Request an image that WILL BE stored in this image atlas by supplying ImageAtlasImageInfo.&nbsp; If this function returns true, this means the operation is successful and can store the image by querying the ImageAtlasImageInfo with returnId where it will tell you where to store.</p></div>
</div>

<a name="RemoveImage"></a><a name="Topic625"></a><div class="CTopic TFunction LC">
 <div class="CTitle">RemoveImage</div>
 <div id="NDPrototype625" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> RemoveImage(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">id</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Removes an existing image that is occupying this image atlas by supplying the image Id returned by <a href="../../../../index.html#CClass:ssGUI.Backend.DynamicImageAtlas:RequestImage" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,624);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >RequestImage</a></p></div>
</div>

<a name="GetImageInfo"></a><a name="Topic626"></a><div class="CTopic TFunction LC">
 <div class="CTitle">GetImageInfo</div>
 <div id="NDPrototype626" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">bool</span> GetImageInfo(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">id,</td></tr><tr><td class="PType first">ImageAtlasImageInfo&amp;&nbsp;</td><td class="PName last">returnInfo</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Returns the infomation on where the image can be stored on the image atlas.</p></div>
</div>

<a name="AddOnRequestNewAtlasCallback"></a><a name="Topic627"></a><div class="CTopic TFunction LC">
 <div class="CTitle">AddOnRequestNewAtlasCallback</div>
 <div id="NDPrototype627" class="NDPrototype WideForm"><div class="PSection PParameterSection CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> AddOnRequestNewAtlasCallback(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first">std::</td><td class="PType"><span class="SHKeyword">function</span>&lt;<span class="SHKeyword">bool</span>(<span class="SHKeyword">void</span>)&gt;&nbsp;</td><td class="PName last">callback</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div></div>
 <div class="CBody"><p>Registers a callback function which allocates a new layer of image atlas which returns boolean.&nbsp; If the callback function returns true, it means the new allocation was successful, otherwise failed.</p></div>
</div>

<a name="GetAtlasSize"></a><a name="Topic770"></a><div class="CTopic TFunction LC last">
 <div class="CTitle">GetAtlasSize</div>
 <div id="NDPrototype770" class="NDPrototype"><div class="PSection PPlainSection">glm::ivec2 GetAtlasSize()</div></div>
 <div class="CBody"><p>The size in pixels for each layer of image atlas</p></div>
</div>

</body></html>